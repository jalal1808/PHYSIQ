<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physiq AI | Your AI Coach ‚ö°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .chat-scrollbar::-webkit-scrollbar { width: 5px; }
        .chat-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        .gradient-text { background: linear-gradient(90deg, #818cf8, #c084fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>

<body class="bg-slate-950 text-slate-200 h-screen overflow-hidden selection:bg-indigo-500/30">

<script>
    const API_BASE = "http://localhost:8000";
    let isSignup = false;

    const get = (id) => document.getElementById(id);

    window.onload = () => {
        if (localStorage.getItem("access_token")) showApp();
    };

    function toggleAuthMode() {
        isSignup = !isSignup;
        get("signup-fields").classList.toggle("hidden", !isSignup);
        get("auth-title").innerHTML = isSignup ? "Join the Movement üöÄ" : "Welcome Back üëã";
        get("auth-btn-text").innerText = isSignup ? "Create Account" : "Sign In";
        get("toggle-text").innerText = isSignup ? "Already have an account? Login" : "New here? Create an account";
    }

    async function authSubmit(e) {
        e.preventDefault();
        const btn = e.submitter;
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerText = "Hold on... ‚è≥";

        const email = get("emailInput").value;
        const password = get("passwordInput").value;

        try {
            if (isSignup) {
                const res = await fetch(`${API_BASE}/auth/signup`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        email, password,
                        weight_kg: Number(get("weightInput").value) || null,
                        height_cm: Number(get("heightInput").value) || null,
                    }),
                });
                if (!res.ok) throw await res.json();
                alert("Account created! Let's get you signed in. üéâ");
                toggleAuthMode();
            } else {
                const res = await fetch(`${API_BASE}/auth/login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password }),
                });
                const data = await res.json();
                if (!res.ok) throw data;
                localStorage.setItem("access_token", data.access_token);
                showApp();
            }
        } catch (err) {
            alert(err.detail || "Oops! Something went wrong. ‚ùå");
        } finally {
            btn.disabled = false;
            btn.innerHTML = originalText;
        }
    }

    function showApp() {
        get("authSection").classList.add("hidden");
        get("appSection").classList.remove("hidden");
        get("appSection").classList.add("flex");
    }

    async function logout() {
        try {
            await fetch(`${API_BASE}/auth/logout`, {
                method: "POST",
                headers: { Authorization: `Bearer ${localStorage.getItem("access_token")}` },
            });
        } finally {
            localStorage.clear();
            location.reload();
        }
    }

    async function sendMessage(e) {
        e.preventDefault();
        const input = get("chatInput");
        const msg = input.value.trim();
        if (!msg) return;

        append("You", msg, true);
        input.value = "";

        try {
            const res = await fetch(`${API_BASE}/chat`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${localStorage.getItem("access_token")}`,
                },
                body: JSON.stringify({ message: msg }),
            });
            const data = await res.json();
            if (!res.ok) throw data;
            append("Physiq AI", data.response, false);
        } catch {
            append("System", "Lost connection to the gym... üîå", false);
        }
    }

    async function updateProfile() {
        const btn = event.target;
        btn.innerText = "Saving... üíæ";
        try {
            const res = await fetch(`${API_BASE}/user/profile`, {
                method: "PATCH",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${localStorage.getItem("access_token")}`,
                },
                body: JSON.stringify({
                    weight_kg: Number(get("profileWeight").value),
                    height_cm: Number(get("profileHeight").value),
                }),
            });
            if (!res.ok) throw await res.json();
            alert("Profile updated! üåü");
        } catch (e) {
            alert(e.detail || "Update failed ‚ö†Ô∏è");
        } finally {
            btn.innerText = "Update Stats üìà";
        }
    }

    function append(sender, text, isUser) {
        const box = get("chatBox");
        const div = document.createElement("div");
        div.className = `flex ${isUser ? 'justify-end' : 'justify-start'} mb-4 animate-in fade-in slide-in-from-bottom-2 duration-300`;
        
        div.innerHTML = `
            <div class="max-w-[85%] p-4 rounded-2xl ${isUser ? 'bg-indigo-600 text-white rounded-tr-none shadow-lg shadow-indigo-500/20' : 'bg-slate-800 text-slate-200 rounded-tl-none border border-slate-700 shadow-sm'}">
                <p class="text-[10px] font-bold mb-1 uppercase tracking-wider opacity-60">${isUser ? 'üë§ You' : 'ü§ñ Physiq AI'}</p>
                <p class="text-sm leading-relaxed">${text}</p>
            </div>
        `;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }
</script>

<div id="authSection" class="flex items-center justify-center h-full px-4 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-indigo-900/40 via-slate-950 to-slate-950">
    <div class="glass p-10 rounded-[2rem] w-full max-w-md shadow-2xl relative overflow-hidden">
        <div class="absolute -top-10 -right-10 w-32 h-32 bg-indigo-600/20 rounded-full blur-3xl"></div>
        
        <div class="flex justify-center mb-8">
            <div class="bg-gradient-to-br from-indigo-500 to-purple-600 p-4 rounded-2xl shadow-xl">
                <i data-lucide="flame" class="w-10 h-10 text-white"></i>
            </div>
        </div>
        
        <h2 id="auth-title" class="text-3xl font-bold text-center mb-2 tracking-tight">Welcome Back üëã</h2>
        <p class="text-slate-400 text-center mb-10 text-sm">Unlock your potential with AI-driven insights.</p>

        <form onsubmit="authSubmit(event)" class="space-y-4">
            <input id="emailInput" type="email" placeholder="Email Address"
                class="w-full p-4 rounded-xl bg-slate-900/50 border border-slate-700 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-all" required />
            
            <input id="passwordInput" type="password" placeholder="Password"
                class="w-full p-4 rounded-xl bg-slate-900/50 border border-slate-700 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-all" required />

            <div id="signup-fields" class="hidden space-y-4 animate-in fade-in zoom-in-95 duration-200">
                <div class="grid grid-cols-2 gap-4">
                    <input id="weightInput" type="number" placeholder="Weight (kg)"
                        class="w-full p-4 rounded-xl bg-slate-900/50 border border-slate-700 focus:border-indigo-500 outline-none" />
                    <input id="heightInput" type="number" placeholder="Height (cm)"
                        class="w-full p-4 rounded-xl bg-slate-900/50 border border-slate-700 focus:border-indigo-500 outline-none" />
                </div>
            </div>

            <button id="auth-btn" class="bg-indigo-600 hover:bg-indigo-500 w-full p-4 rounded-xl font-bold text-white shadow-lg shadow-indigo-500/30 transition-all active:scale-[0.97] flex justify-center items-center gap-2">
                <span id="auth-btn-text">Sign In</span> <i data-lucide="chevron-right" class="w-4 h-4"></i>
            </button>

            <p id="toggle-text" class="mt-8 text-center text-sm font-medium cursor-pointer text-indigo-400 hover:text-indigo-300 transition-colors"
                onclick="toggleAuthMode()">New here? Create an account</p>
        </form>
    </div>
</div>

<div id="appSection" class="hidden h-full flex flex-col md:flex-row bg-slate-950">
    <aside class="w-full md:w-80 bg-slate-900/40 border-r border-slate-800 p-8 flex flex-col">
        <div class="flex items-center gap-3 mb-12">
            <div class="bg-indigo-600 p-2 rounded-lg shadow-lg shadow-indigo-500/20"><i data-lucide="zap" class="w-6 h-6 text-white"></i></div>
            <h1 class="text-2xl font-black tracking-tighter gradient-text">PHYSIQ AI</h1>
        </div>

        <div class="space-y-10 flex-1 overflow-y-auto no-scrollbar">
            <div>
                <label class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] mb-4 block">Stats & Profile üìä</label>
                <div class="space-y-4">
                    <div class="relative group">
                        <i data-lucide="scale" class="absolute left-4 top-3.5 w-4 h-4 text-slate-500 group-focus-within:text-indigo-400 transition-colors"></i>
                        <input id="profileWeight" placeholder="Weight (kg)"
                            class="w-full pl-12 p-3.5 bg-slate-800/40 border border-slate-700 rounded-2xl text-sm outline-none focus:border-indigo-500 focus:bg-slate-800/60 transition-all">
                    </div>
                    <div class="relative group">
                        <i data-lucide="ruler" class="absolute left-4 top-3.5 w-4 h-4 text-slate-500 group-focus-within:text-indigo-400 transition-colors"></i>
                        <input id="profileHeight" placeholder="Height (cm)"
                            class="w-full pl-12 p-3.5 bg-slate-800/40 border border-slate-700 rounded-2xl text-sm outline-none focus:border-indigo-500 focus:bg-slate-800/60 transition-all">
                    </div>
                    <button onclick="updateProfile()" class="bg-white/5 hover:bg-white/10 text-white border border-white/10 w-full p-3.5 rounded-2xl text-sm font-bold transition-all active:scale-[0.98]">
                        Update Stats üìà
                    </button>
                </div>
            </div>

            <div class="p-5 rounded-2xl bg-indigo-500/10 border border-indigo-500/20">
                <p class="text-xs font-bold text-indigo-400 mb-2 flex items-center gap-2">
                    <i data-lucide="lightbulb" class="w-4 h-4"></i> Coach Tip
                </p>
                <p class="text-xs text-slate-400 leading-relaxed">
                    Consistency beats intensity. Try to log your workout data daily to get better AI feedback! üèãÔ∏è‚Äç‚ôÇÔ∏è
                </p>
            </div>
        </div>

        <button onclick="logout()" class="flex items-center justify-center gap-2 text-slate-500 hover:text-red-400 p-4 rounded-2xl hover:bg-red-400/10 transition-all text-sm font-bold mt-8 border border-transparent hover:border-red-400/20">
            <i data-lucide="log-out" class="w-4 h-4"></i> Sign Out
        </button>
    </aside>

    <main class="flex-1 flex flex-col relative">
        <header class="px-8 py-5 border-b border-slate-800 flex justify-between items-center bg-slate-950/80 backdrop-blur-xl sticky top-0 z-20">
            <div class="flex items-center gap-3">
                <div class="relative">
                    <div class="w-10 h-10 rounded-full bg-slate-800 border border-slate-700 flex items-center justify-center text-xl">ü§ñ</div>
                    <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-slate-950 animate-pulse"></span>
                </div>
                <div>
                    <h2 class="text-sm font-bold">Fitness Coach AI</h2>
                    <p class="text-[10px] text-slate-500 font-medium">Always active ‚Ä¢ Ready to help ‚ö°</p>
                </div>
            </div>
        </header>

        <div id="chatBox" class="flex-1 overflow-y-auto px-8 py-8 chat-scrollbar space-y-4">
            <div class="flex justify-start mb-4">
                <div class="max-w-[85%] p-4 rounded-2xl bg-slate-800 text-slate-200 rounded-tl-none border border-slate-700 shadow-sm">
                    <p class="text-[10px] font-bold mb-1 uppercase tracking-wider opacity-60">ü§ñ Physiq AI</p>
                    <p class="text-sm leading-relaxed">Hey there! I'm your Physiq AI coach. üèãÔ∏è‚Äç‚ôÄÔ∏è Ready to crush your goals? Just ask me about workouts, nutrition, or your progress!</p>
                </div>
            </div>
        </div>

        <div class="p-6 bg-gradient-to-t from-slate-950 via-slate-950 to-transparent">
            <form onsubmit="sendMessage(event)" class="max-w-4xl mx-auto relative group">
                <input id="chatInput" autocomplete="off" placeholder="Type a message... üî•"
                    class="w-full p-5 pr-16 bg-slate-900/80 border border-slate-700 rounded-[1.5rem] focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none shadow-2xl transition-all placeholder:text-slate-600" />
                <button class="absolute right-3 top-3 p-3 bg-indigo-600 rounded-2xl hover:bg-indigo-500 transition-all shadow-lg shadow-indigo-500/20 active:scale-90">
                    <i data-lucide="send-horizontal" class="w-5 h-5 text-white"></i>
                </button>
            </form>
            <p class="text-[9px] text-center text-slate-600 mt-4 uppercase tracking-[0.2em] font-bold">Powered by Physiq Intelligence ‚Ä¢ 2026</p>
        </div>
    </main>
</div>

<script>lucide.createIcons();</script>
</body>
</html>